---
phase: 04-database-schema-redesign
plan: 04
type: execute
wave: 3
depends_on: ["04-01", "04-02", "04-03"]
files_modified: [supabase/seed.sql]
autonomous: false
---

<objective>
Create seed data and verify the complete database setup works with the application.

Purpose: Provide initial data for the database and ensure the full stack (DB + app) functions correctly.
Output: Seed file with sample data, verified working application.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-database-schema-redesign/04-CONTEXT.md

@src/data/sampleData.js
@supabase/migrations/001_core_tables.sql
@supabase/migrations/002_suggestions_and_rate_limiting.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create seed file from sample data</name>
  <files>supabase/seed.sql</files>
  <action>
Create `supabase/seed.sql` that populates the database with initial data from sampleData.js:

**1. Insert categories:**
```sql
INSERT INTO categories (id, name, icon, color_hex, color_name) VALUES
  ('nature', 'Nature & Outdoors', 'üå≤', '#4CAF50', 'green'),
  ('city', 'Cities & Towns', 'üèôÔ∏è', '#2196F3', 'blue'),
  ('food', 'Food & Dining', 'üç¥', '#F44336', 'red'),
  ('culture', 'Culture & History', 'üé®', '#9C27B0', 'violet'),
  ('beach', 'Beaches & Islands', 'üèñÔ∏è', '#FFC107', 'yellow')
ON CONFLICT (id) DO NOTHING;
```

**2. Insert sample locations:**
Convert each location from sampleData.js to an INSERT statement:
- Use gen_random_uuid() for id (let DB generate)
- Map category field to category_id
- Include slug, name, latitude, longitude, has_visited, date_visited, short_description, notes

Example:
```sql
INSERT INTO locations (slug, name, latitude, longitude, category_id, has_visited, date_visited, short_description, notes) VALUES
  ('reykjavik-iceland', 'Reykjavik, Iceland', 64.1466, -21.9426, 'city', true, '2024-06-15', 'Vibrant capital with northern lights and hot springs', 'Amazing northern lights and geothermal pools'),
  -- ... all 10 sample locations
ON CONFLICT (slug) DO NOTHING;
```

**3. Add comment header:**
```sql
-- Seed data for Travel Map application
-- Run this after migrations to populate initial data
-- Generated from src/data/sampleData.js
```

Do NOT include any videos in seed data - those will be added by admin later.
  </action>
  <verify>File contains INSERT statements for categories and locations: `grep -c "INSERT INTO" supabase/seed.sql` returns at least 2</verify>
  <done>seed.sql created with categories and sample locations</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Apply database migrations and seed data to Supabase</action>
  <instructions>
I've created the following SQL files that need to be run in your Supabase project:

**Files to run (in order):**
1. `supabase/migrations/001_core_tables.sql` - Creates categories, locations, videos, location_videos tables
2. `supabase/migrations/002_suggestions_and_rate_limiting.sql` - Creates suggestions, reminders, counting tables
3. `supabase/seed.sql` - Populates initial data

**How to apply:**
1. Go to your Supabase project dashboard
2. Navigate to **SQL Editor**
3. Create a new query
4. Copy and paste the contents of each file (in order)
5. Click **Run** for each file

**Alternative (if you have Supabase CLI):**
```bash
supabase link --project-ref YOUR_PROJECT_REF
supabase db push
supabase db reset --seed  # This runs migrations + seed
```

**Verify tables were created:**
In Supabase dashboard ‚Üí Table Editor, you should see:
- categories (5 rows)
- locations (10 rows)
- videos (0 rows)
- location_videos (0 rows)
- suggestions (0 rows)
- reminders (0 rows)
- user_suggestion_counts (0 rows)
- user_reminder_counts (0 rows)
  </instructions>
  <verification>Tables visible in Supabase dashboard with correct row counts</verification>
  <resume-signal>Type "migrations applied" when done</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Database schema with RLS policies and app integration</what-built>
  <how-to-verify>
1. Run the development server:
   ```bash
   npm run dev
   ```

2. Open the app in your browser (usually http://localhost:5173)

3. Navigate to the Map page:
   - **Verify:** Map loads with markers
   - **Verify:** You see the 10 sample locations from the database
   - **Verify:** Category filters work
   - **Verify:** Status filters (visited/not visited) work

4. Open browser dev tools (F12) ‚Üí Console:
   - **Verify:** No errors about "Failed to fetch locations"
   - If you see "using sample data" warning, the DB connection may not be working

5. Navigate to Suggest page:
   - **Verify:** Login if needed
   - **Verify:** Form displays correctly
   - (Optional) Submit a test suggestion and check it appears in Supabase dashboard ‚Üí suggestions table
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] seed.sql contains categories and locations data
- [ ] User confirmed migrations applied to Supabase
- [ ] User verified app loads locations from database
- [ ] User verified filters work correctly
- [ ] No console errors related to database
</verification>

<success_criteria>

- All tasks completed
- Database migrations successfully applied
- App displays data from real database
- Suggestion form works with new schema
- Rate limiting triggers are active (testable by submitting suggestions)
</success_criteria>

<output>
After completion, create `.planning/phases/04-database-schema-redesign/04-04-SUMMARY.md`
</output>
