---
phase: 11-security-hardening
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/SuggestForm.jsx
  - src/components/LocationSuggestionForm.jsx
  - src/services/suggestionService.js
autonomous: true
---

<objective>
Apply security utilities to user input forms and document SQL injection audit.

Purpose: Integrate URL validation with user feedback and sanitize all user content before database storage.
Output: Forms validate Google Maps URLs with user feedback, all user content sanitized before database insert.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/11-security-hardening/11-CONTEXT.md
@.planning/phases/11-security-hardening/11-01-SUMMARY.md

@src/components/SuggestForm.jsx
@src/components/LocationSuggestionForm.jsx
@src/services/suggestionService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add URL validation to SuggestForm</name>
  <files>src/components/SuggestForm.jsx</files>
  <action>
Integrate URL validation in the SuggestForm component:

1. Import isValidGoogleMapsUrl from parseGoogleMapsUrl utility
2. Before calling parseGoogleMapsUrlAsync, validate the URL:
   - If invalid, set error state with the user-friendly message
   - Don't proceed with parsing
3. Show the error message near the URL input field
4. Clear error when user starts typing a new URL

This provides immediate feedback for invalid URLs per CONTEXT.md vision.
  </action>
  <verify>Invalid URLs show error message, valid Google Maps URLs proceed to parsing</verify>
  <done>SuggestForm validates URLs before processing with user feedback</done>
</task>

<task type="auto">
  <name>Task 2: Add URL validation to LocationSuggestionForm</name>
  <files>src/components/LocationSuggestionForm.jsx</files>
  <action>
Integrate URL validation in the LocationSuggestionForm component (map popup form):

1. Import isValidGoogleMapsUrl from parseGoogleMapsUrl utility
2. Add validation before form submission if URL is provided
3. Show error message if URL is invalid
4. Allow submission without URL (it's optional in this form)

Note: This form is for "remind me to visit" - URL may not be provided. Only validate if URL is present.
  </action>
  <verify>Invalid URLs show error, valid URLs or empty URLs proceed</verify>
  <done>LocationSuggestionForm validates optional URLs</done>
</task>

<task type="auto">
  <name>Task 3: Add sanitization to suggestionService</name>
  <files>src/services/suggestionService.js</files>
  <action>
Apply content sanitization at the service layer (defense in depth):

1. Import sanitizeForDatabase from sanitize utility
2. In submitSuggestion: sanitize locationName and reason before insert
3. In submitReminder: sanitize message before insert

This is silent sanitization - no user feedback, just clean the data.

Note: Supabase already uses parameterized queries (no string concatenation in our code), so SQL injection is already prevented. This sanitization adds XSS defense-in-depth for when data is displayed.
  </action>
  <verify>Service functions sanitize text inputs before database insert</verify>
  <done>User content sanitized before database storage</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] SuggestForm shows user error for invalid URLs
- [ ] LocationSuggestionForm validates optional URL field
- [ ] suggestionService sanitizes text before insert
- [ ] npm run build succeeds
- [ ] Manual test: enter invalid URL in suggest form, see error message
</verification>

<success_criteria>

- Invalid Google Maps URLs rejected with user-friendly message
- All user text content sanitized before database
- Supabase parameterized queries confirmed (already in place)
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-security-hardening/11-02-SUMMARY.md`
</output>
