---
phase: 07-testing-polish
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/hooks/useMapFilters.test.js
  - vite.config.js
autonomous: true
---

<objective>
Add component/hook tests using React Testing Library for useMapFilters hook.

Purpose: The useMapFilters hook contains filter logic that is testable without UI rendering. This extends test coverage to React-specific code.
Output: Test suite for useMapFilters hook with mocked Supabase.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/07-testing-polish/07-01-SUMMARY.md

@src/hooks/useMapFilters.js
@src/utils/parseGoogleMapsUrl.test.js
@vite.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up React Testing Library</name>
  <files>vite.config.js, package.json</files>
  <action>
1. Install React Testing Library:
   `npm install -D @testing-library/react @testing-library/dom jsdom`

2. Update vite.config.js to add test configuration:
   ```javascript
   test: {
     environment: 'jsdom',
     globals: true,
     setupFiles: ['./src/test/setup.js'],
   }
   ```

3. Create src/test/setup.js with:
   ```javascript
   import '@testing-library/jest-dom';
   ```

4. Install jest-dom matchers:
   `npm install -D @testing-library/jest-dom`
  </action>
  <verify>`npm test` still passes existing tests</verify>
  <done>React Testing Library configured in Vitest</done>
</task>

<task type="auto">
  <name>Task 2: Create useMapFilters hook tests</name>
  <files>src/hooks/useMapFilters.test.js</files>
  <action>
Create tests for useMapFilters hook. Test the pure logic functions and state management:

**Test cases:**
1. Initial state: all categories selected, both statuses selected
2. toggleCategory: removes category when selected, adds when not selected
3. toggleStatus: toggles visited/not-visited status
4. selectAllCategories: selects all available categories
5. deselectAllCategories: clears category selection
6. Filter logic: locations filtered by selected categories and statuses

**Mock approach:**
- Mock the Supabase client to return test data
- Use renderHook from @testing-library/react
- Don't test actual Supabase calls (that's integration testing)

**Pattern:**
```javascript
import { renderHook, act } from '@testing-library/react';
import { vi } from 'vitest';
import useMapFilters from './useMapFilters';

// Mock supabase
vi.mock('../utils/supabaseClient', () => ({
  supabase: {
    from: () => ({
      select: () => ({
        order: () => Promise.resolve({ data: mockCategories, error: null })
      })
    })
  }
}));
```
  </action>
  <verify>`npm test` passes all hook tests</verify>
  <done>useMapFilters hook has test coverage for filter logic</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm test` passes all tests
- [ ] React Testing Library properly configured
- [ ] Hook tests cover toggle and filter logic
</verification>

<success_criteria>
- All tasks completed
- Test suite includes hook tests
- No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/07-testing-polish/07-03-SUMMARY.md`
</output>
