---
phase: 18-dynamic-stats
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [supabase/migrations/014_about_content_stats.sql, src/services/locationService.js, src/services/aboutService.js]
autonomous: true
---

<objective>
Add stats columns to about_content table and create service functions for fetching/updating stats.

Purpose: Establish data model and service layer for dynamic stats (location count, video count, countries count, subscriber count).
Output: Migration file, extended locationService with count functions, extended aboutService with stats operations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-dynamic-stats/18-CONTEXT.md

@supabase/migrations/012_about_content_table.sql
@src/services/aboutService.js
@src/services/locationService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add stats columns to about_content table</name>
  <files>supabase/migrations/014_about_content_stats.sql</files>
  <action>
Create migration to add stats columns to about_content table:
- location_count INTEGER (nullable, for manual override)
- video_count INTEGER (nullable, for manual override)
- country_count INTEGER (nullable, for manual override)
- subscriber_count INTEGER (nullable, for YouTube subscriber count)
- stats_updated_at TIMESTAMPTZ (tracks when stats were last refreshed)

Use ALTER TABLE to add columns. All nullable since they're optional overrides.
No RLS changes needed - same policies apply.

Follow existing migration naming pattern (014_about_content_stats.sql).
  </action>
  <verify>Migration file exists with correct ALTER TABLE statements</verify>
  <done>Migration file created at supabase/migrations/014_about_content_stats.sql</done>
</task>

<task type="auto">
  <name>Task 2: Add count functions to locationService</name>
  <files>src/services/locationService.js</files>
  <action>
Add two new exported functions to locationService.js:

1. `fetchLocationCount()` - Returns count of all locations
   - Use supabase `.select('*', { count: 'exact', head: true })` pattern
   - Return integer count or null on error

2. `fetchCountryCount()` - Returns count of unique countries
   - Query locations table with distinct country names
   - Filter out null/empty country values
   - Return integer count or null on error

Both functions should follow existing pattern: console.warn on error, return null for graceful fallback.
  </action>
  <verify>Functions exported and callable</verify>
  <done>fetchLocationCount() and fetchCountryCount() added to locationService.js</done>
</task>

<task type="auto">
  <name>Task 3: Extend aboutService with stats update function</name>
  <files>src/services/aboutService.js</files>
  <action>
Add new function to aboutService.js:

`updateAboutStats(stats)` - Update stats fields only
- Accept object with: location_count, video_count, country_count, subscriber_count
- Update stats_updated_at to NOW()
- Return { success, data, error } pattern like updateAboutContent()
- Filter out undefined values to allow partial updates

No changes needed to fetchAboutContent or updateAboutContent - they already handle all columns via `select('*')`.
  </action>
  <verify>Function exported and callable</verify>
  <done>updateAboutStats() added to aboutService.js</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file exists with correct column definitions
- [ ] locationService exports fetchLocationCount and fetchCountryCount
- [ ] aboutService exports updateAboutStats
- [ ] All new functions follow existing service patterns (null on error, { success, data, error } for updates)
</verification>

<success_criteria>
- All tasks completed
- Migration ready to apply
- Service functions ready for UI integration
- No TypeScript/lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-dynamic-stats/18-01-SUMMARY.md`
</output>
