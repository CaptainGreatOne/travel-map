---
phase: 02-component-decomposition
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/hooks/useMapFilters.js, src/components/MarkerPopup.jsx, src/utils/mapStyles.js]
autonomous: true
---

<objective>
Extract reusable pieces from MapPage: custom hook, popup component, and map configuration.

Purpose: Prepare MapPage for refactoring by isolating independent concerns.
Output: Three new files ready to be imported by MapPage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/pages/MapPage.jsx
@src/data/sampleData.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract useMapFilters custom hook</name>
  <files>src/hooks/useMapFilters.js</files>
  <action>
    Create a custom hook that encapsulates all filter-related state and logic from MapPage:

    - State: selectedStatuses, selectedCategories, mapStyle, colorScheme, filtersOpen
    - Computed: categoriesWithCounts, filteredLocations, visitedCount, wantToVisitCount
    - Handlers: handleToggleStatus, handleToggleCategory, setMapStyle, setColorScheme, setFiltersOpen

    Hook signature:
    ```js
    export function useMapFilters(locations, categoryData) {
      // ... state and logic
      return {
        // Filter state
        selectedStatuses, selectedCategories, mapStyle, colorScheme, filtersOpen,
        // Computed values
        categoriesWithCounts, filteredLocations, visitedCount, wantToVisitCount,
        // Handlers
        handleToggleStatus, handleToggleCategory, setMapStyle, setColorScheme, setFiltersOpen
      };
    }
    ```

    Copy the exact logic from MapPage lines 41-108 (state declarations, useMemo hooks, toggle handlers).
  </action>
  <verify>File exists and exports useMapFilters function</verify>
  <done>useMapFilters hook created with all filter state and logic</done>
</task>

<task type="auto">
  <name>Task 2: Extract MarkerPopup component</name>
  <files>src/components/MarkerPopup.jsx</files>
  <action>
    Extract the popup content rendering from MapPage (lines 250-321) into a standalone component.

    Props:
    - location: the location object
    - categoryInfo: category data for this location
    - isShowingForm: boolean for form visibility
    - isSuccess: boolean for success state
    - user: auth user object
    - onShowForm: callback when "Remind Me" clicked
    - onCancelForm: callback when form cancelled
    - onSuccess: callback when suggestion submitted

    Component renders:
    - Location name heading
    - Status badge (visited/want-to-visit)
    - Success message (conditional)
    - LocationSuggestionForm OR location details (conditional)
    - Category badge, description, action button

    Import LocationSuggestionForm from '../components/LocationSuggestionForm'.
  </action>
  <verify>File exists and exports MarkerPopup component</verify>
  <done>MarkerPopup component created with all popup rendering logic</done>
</task>

<task type="auto">
  <name>Task 3: Extract map style configuration</name>
  <files>src/utils/mapStyles.js</files>
  <action>
    Extract the mapStyles configuration object from MapPage (lines 130-151) into a utility file.

    Also extract the createColoredIcon helper function (lines 23-32).

    Exports:
    ```js
    export const mapStyles = {
      standard: { url: "...", attribution: "..." },
      terrain: { ... },
      satellite: { ... },
      watercolor: { ... },
      dark: { ... }
    };

    export function createColoredIcon(colorName) {
      return new L.Icon({ ... });
    }
    ```

    Import L from 'leaflet' at top of file.
  </action>
  <verify>File exists and exports mapStyles object and createColoredIcon function</verify>
  <done>Map configuration extracted to utility file</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/hooks/useMapFilters.js exists and exports hook
- [ ] src/components/MarkerPopup.jsx exists and exports component
- [ ] src/utils/mapStyles.js exists and exports mapStyles + createColoredIcon
- [ ] No syntax errors in new files
</verification>

<success_criteria>
- All three extraction files created
- Each file is self-contained and importable
- Original MapPage still works (not modified yet)
</success_criteria>

<output>
After completion, create `.planning/phases/02-component-decomposition/02-01-SUMMARY.md`
</output>
