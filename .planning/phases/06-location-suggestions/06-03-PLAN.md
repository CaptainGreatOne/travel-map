---
phase: 06-location-suggestions
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - src/components/SuggestForm.jsx
  - src/components/LocationPreview.jsx
autonomous: false
---

<objective>
Add live location preview and improved error messaging to SuggestForm.

Purpose: Users should see instant visual feedback when they paste a URL - the parsed location name and coordinates appear immediately.
Output: LocationPreview component showing parsed data, integrated into SuggestForm with helpful validation messages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-location-suggestions/06-CONTEXT.md

@.planning/phases/06-location-suggestions/06-01-SUMMARY.md
@.planning/phases/06-location-suggestions/06-02-SUMMARY.md

@src/components/SuggestForm.jsx
@src/utils/parseGoogleMapsUrl.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LocationPreview component</name>
  <files>src/components/LocationPreview.jsx</files>
  <action>
Create LocationPreview component in src/components/:

Props:
- `name` (string|null): Extracted location name
- `lat` (number|null): Latitude
- `lng` (number|null): Longitude
- `loading` (boolean): Whether URL is being parsed
- `error` (string|null): Error message to display
- `isShortUrl` (boolean): Whether URL is a short URL being expanded

Display states:
1. **Loading**: Show spinner with "Parsing URL..." text
2. **Success with name + coords**: Green checkmark, location name, small map pin icon with coords
3. **Success with name only**: Yellow/amber hint that coordinates couldn't be extracted
4. **Success with coords only**: Show coords, hint that name couldn't be extracted
5. **Short URL expanding**: Show "Expanding short URL..." with spinner
6. **Error**: Red text with helpful message

Styling:
- Use Tailwind classes consistent with existing components
- Compact design that fits below the URL input
- Smooth transition when content appears/changes

Example success state:
```
‚úì Eiffel Tower
  üìç 48.8584, 2.2945
```

Example partial state:
```
‚ö† Coordinates found: 48.8584, 2.2945
  Tip: Enter a location name manually
```
  </action>
  <verify>Component file exists with proper React structure and Tailwind styling.</verify>
  <done>LocationPreview component created with all display states.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate preview into SuggestForm</name>
  <files>src/components/SuggestForm.jsx</files>
  <action>
Update SuggestForm to use LocationPreview:

1. Add state for preview data:
   - `previewData: { name, lat, lng, loading, error, isShortUrl }`
   - Initialize as null (no preview shown until URL entered)

2. Update `handleGoogleMapsLinkChange`:
   - Set `loading: true` immediately when URL detected
   - Call parseGoogleMapsUrlAsync
   - Update preview state with result
   - Set `loading: false` when done
   - Clear preview when URL input is emptied

3. Add LocationPreview below the Google Maps Link input:
   - Only render when googleMapsLink has content
   - Pass preview data as props

4. Update validation messaging:
   - When preview shows coordinates, auto-fill is optional
   - When preview shows error, show helpful guidance
   - Keep existing short URL hint but improve wording

5. Improve error messages to be helpful:
   - "We couldn't recognize this URL format. Try copying the URL directly from your browser's address bar."
   - "Short link detected. We're expanding it..." (while loading)
   - "Couldn't expand short link. Try opening it in a new tab and copying the full URL."
  </action>
  <verify>`npm run build` succeeds, no TypeScript/lint errors.</verify>
  <done>SuggestForm shows live preview of parsed URL with helpful feedback.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Live location preview when pasting Google Maps URLs in the suggestion form</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:5173/suggest (or your dev port)
    3. Log in if needed
    4. Test full URL:
       - Paste: `https://www.google.com/maps/place/Eiffel+Tower/@48.8583736,2.2920609,17z`
       - Verify: Preview shows "Eiffel Tower" with coordinates
       - Verify: Location name field auto-fills
    5. Test search URL:
       - Paste: `https://www.google.com/maps/search/Central+Park`
       - Verify: Preview shows "Central Park"
    6. Test short URL (if Edge Function deployed):
       - Paste a maps.app.goo.gl link
       - Verify: Shows "Expanding..." then parsed result
    7. Test short URL fallback (if Edge Function not deployed):
       - Paste a maps.app.goo.gl link
       - Verify: Shows helpful message about copying full URL
    8. Test invalid URL:
       - Paste: `https://example.com/not-a-map`
       - Verify: Shows helpful error, not technical message
    9. Check mobile responsiveness at 375px width
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] LocationPreview component created with all states
- [ ] SuggestForm shows preview on URL paste
- [ ] Error messages are helpful, not technical
- [ ] Human verification passed
</verification>

<success_criteria>
- All tasks completed
- Human approved the UX flow
- Paste-and-preview works smoothly
- Error messages guide users to success
</success_criteria>

<output>
After completion, create `.planning/phases/06-location-suggestions/06-03-SUMMARY.md`
</output>
