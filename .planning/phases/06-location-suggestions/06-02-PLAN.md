---
phase: 06-location-suggestions
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/utils/parseGoogleMapsUrl.js
  - src/utils/parseGoogleMapsUrl.test.js
autonomous: true
---

<objective>
Enhance URL parser with TDD to handle more Google Maps URL formats.

Purpose: The vision demands "any Google Maps link should parse correctly." TDD ensures robust parsing across diverse URL patterns.
Output: Tested, enhanced URL parser handling additional formats (search URLs, place IDs, mobile URLs).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-location-suggestions/06-CONTEXT.md

@src/utils/parseGoogleMapsUrl.js
</context>

<feature>
  <name>Enhanced Google Maps URL Parsing</name>
  <files>src/utils/parseGoogleMapsUrl.js, src/utils/parseGoogleMapsUrl.test.js</files>
  <behavior>
Test cases for URL formats that should be handled:

1. **Search result URLs** (currently may fail):
   - `https://www.google.com/maps/search/Eiffel+Tower` → name: "Eiffel Tower"
   - `https://www.google.com/maps/search/restaurants+near+me/@48.8584,2.2945,15z` → coordinates

2. **Place URLs with data parameter** (name extraction improvement):
   - URLs containing `!1s...` place ID patterns
   - URLs with `data=` parameter containing place info

3. **Mobile web URLs**:
   - `https://maps.google.com/maps?q=...` → extract from q parameter
   - `https://www.google.com/maps?q=40.7128,-74.0060` → coordinates from q

4. **Plus codes** (nice to have):
   - `https://www.google.com/maps/place/8FVC9G8F+5W` → detect as plus code

5. **Shared location URLs**:
   - URLs with `@` coordinates after location name

Expected behavior:
- parseGoogleMapsUrl(searchUrl) → extracted search term
- parseGoogleMapsCoordinates(mobileUrl) → { lat, lng }
- All existing tests continue to pass
  </behavior>
  <implementation>
After tests are written and failing:

1. Add `/search/` pattern to parseGoogleMapsUrl:
   - Match `/search/([^/@]+)` and decode the search term

2. Add `?q=` pattern to parseGoogleMapsCoordinates:
   - Match `q=(-?\d+\.\d+),(-?\d+\.\d+)` for coordinate pairs
   - Match `q=...` for place name searches

3. Improve name extraction:
   - When /place/ pattern fails, try /search/ pattern
   - Decode URL-encoded characters more comprehensively

4. Validate all coordinate patterns against the -90/90, -180/180 bounds
  </implementation>
</feature>

<verification>
`npm test` passes all tests including new URL format cases.
</verification>

<success_criteria>
- Failing tests written first (RED)
- Implementation passes all tests (GREEN)
- Code cleaned up if needed (REFACTOR)
- 2-3 atomic commits produced
</success_criteria>

<output>
After completion, create `.planning/phases/06-location-suggestions/06-02-SUMMARY.md` with:
- RED: What tests were written, why they failed
- GREEN: What implementation made them pass
- REFACTOR: What cleanup was done (if any)
- Commits: List of commits produced
</output>
