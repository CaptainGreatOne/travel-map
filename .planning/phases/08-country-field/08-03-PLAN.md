---
phase: 08-country-field
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified: [src/components/SuggestForm.jsx, src/components/LocationPreview.jsx, src/services/suggestionService.js]
autonomous: true
---

<objective>
Integrate country field into suggestion form and location service.

Purpose: Auto-extract and display country in suggestion workflow so admin receives country data with suggestions.
Output: SuggestForm shows extracted country, suggestionService includes country in submissions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-country-field/08-CONTEXT.md
@.planning/phases/08-country-field/08-01-SUMMARY.md

@src/components/SuggestForm.jsx
@src/components/LocationPreview.jsx
@src/services/suggestionService.js
@src/utils/parseGoogleMapsUrl.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SuggestForm to display extracted country</name>
  <files>src/components/SuggestForm.jsx, src/components/LocationPreview.jsx</files>
  <action>
Update the suggestion form flow to show extracted country:

1. In SuggestForm, update previewData state to include country and countryCode fields
2. When parseGoogleMapsUrlAsync returns, capture country/countryCode in previewData
3. Pass country info to LocationPreview component

4. In LocationPreview, add country display:
   - Show country below coordinates (or alongside location name)
   - Format: "Country: [country_code]" or "[country_code]" badge
   - Only show if country is available (not null)

The country should appear in the preview card after URL is parsed, alongside the existing name and coordinates.
  </action>
  <verify>npm run build succeeds</verify>
  <done>SuggestForm shows extracted country in LocationPreview</done>
</task>

<task type="auto">
  <name>Task 2: Update suggestionService to include country in submission</name>
  <files>src/services/suggestionService.js</files>
  <action>
Update submitSuggestion to accept and store country information:

1. Add country_code parameter to submitSuggestion function signature
2. Include country_code in the data object inserted to location_suggestions table

Note: The location_suggestions table may not have a country_code column yet.
If needed, the submission should gracefully handle this (Supabase ignores unknown columns).
For now, just include it in the insert - admin can see it when reviewing suggestions.

Actually check: The suggestions table is separate from locations. We should:
- Either add country_code to location_suggestions table (new migration)
- Or store it in the notes/metadata field

Preferred approach: Just include country_code in the insert data. If the column doesn't exist, Supabase will ignore it. When admin approves a suggestion, they can see the Google Maps URL and extract country themselves (or we add column later).

For now, pass country_code to submitSuggestion and include in insert. No migration needed for suggestions table in this phase.
  </action>
  <verify>grep -n "country" src/services/suggestionService.js shows country handling</verify>
  <done>suggestionService accepts country_code parameter and attempts to include in submission</done>
</task>

<task type="auto">
  <name>Task 3: Wire up country in SuggestForm submission</name>
  <files>src/components/SuggestForm.jsx</files>
  <action>
Update SuggestForm to pass country to suggestionService on submit:

1. Store countryCode from previewData in component state (alongside locationName, etc.)
2. When form submits, pass countryCode to submitSuggestion
3. Clear countryCode state on successful submission (along with other fields)

The flow:
- User pastes URL → parseGoogleMapsUrlAsync runs → country extracted
- Country shown in preview
- User submits → country passed to submitSuggestion
  </action>
  <verify>npm run build succeeds</verify>
  <done>SuggestForm passes extracted country to suggestionService on submit</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] LocationPreview shows country when available
- [ ] suggestionService accepts country_code parameter
- [ ] SuggestForm passes country through submission flow
</verification>

<success_criteria>
- All tasks completed
- Country visible to users in suggestion preview
- Country included in suggestion submission data
</success_criteria>

<output>
After completion, create `.planning/phases/08-country-field/08-03-SUMMARY.md`
</output>
