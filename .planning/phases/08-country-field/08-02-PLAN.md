---
phase: 08-country-field
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified: [src/components/admin/LocationManager.jsx, src/services/adminService.js]
autonomous: true
---

<objective>
Integrate country field into admin LocationManager with display and filtering.

Purpose: Allow admin to see and filter locations by country for efficient management.
Output: LocationManager shows country column and has country filter dropdown.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-country-field/08-CONTEXT.md
@.planning/phases/08-country-field/08-01-SUMMARY.md

@src/components/admin/LocationManager.jsx
@src/services/adminService.js
@src/utils/parseGoogleMapsUrl.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add country column to LocationManager display</name>
  <files>src/components/admin/LocationManager.jsx</files>
  <action>
Update LocationManager to display country for each location:

1. Add "Country" column header to the location list table
2. Display location.country_code in each row (show "-" if null)
3. Update the location form to include country_code field:
   - Add country_code to getEmptyFormData()
   - Add read-only country_code display field in the form (auto-filled from URL)
   - Parse country from Google Maps URL when URL field changes (use parseGoogleMapsCountry)

When admin pastes a Google Maps URL:
- Extract country using parseGoogleMapsCountry
- Auto-fill the country_code field
- Make country_code field read-only (auto-filled only)

Import parseGoogleMapsCountry from parseGoogleMapsUrl.js
  </action>
  <verify>npm run build succeeds</verify>
  <done>LocationManager shows country column and auto-fills country from URL</done>
</task>

<task type="auto">
  <name>Task 2: Add country filter dropdown to LocationManager</name>
  <files>src/components/admin/LocationManager.jsx</files>
  <action>
Add country filter dropdown to LocationManager:

1. Add state for selected country filter: const [countryFilter, setCountryFilter] = useState('');
2. Compute unique countries from locations list for dropdown options
3. Add dropdown above the locations table with "All Countries" as default plus unique country codes
4. Filter displayed locations based on selected country (client-side filtering)

Dropdown styling should match existing category filter pattern if present, or use standard Tailwind select styling.

The filter should:
- Default to "All Countries" showing all locations
- When a country is selected, only show locations with that country_code
- Handle locations with null country_code (show them in "All" but not in specific country filters)
  </action>
  <verify>npm run build succeeds</verify>
  <done>LocationManager has working country filter dropdown</done>
</task>

<task type="auto">
  <name>Task 3: Update adminService to include country_code in operations</name>
  <files>src/services/adminService.js</files>
  <action>
Update adminService to handle country_code in location CRUD operations:

1. createLocation: Include country_code in insert data
2. updateLocation: Include country_code in update data

The field should be passed through from form data to Supabase operations.
No special handling needed - just ensure it's included in the data objects.
  </action>
  <verify>grep -n "country_code" src/services/adminService.js shows the field in create and update functions</verify>
  <done>adminService passes country_code through in create/update operations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] LocationManager displays country column in location list
- [ ] LocationManager auto-fills country from Google Maps URL
- [ ] LocationManager has country filter dropdown
- [ ] adminService includes country_code in create/update operations
</verification>

<success_criteria>
- All tasks completed
- Admin can see country for each location
- Admin can filter locations by country
- New/edited locations get country auto-filled from URL
</success_criteria>

<output>
After completion, create `.planning/phases/08-country-field/08-02-SUMMARY.md`
</output>
